/**
 * Mobile Navigation Rules
 * 
 * This file contains ALL mobile-specific CSS rules for the navigation.
 * It is dynamically wrapped with @media (max-width: {breakpoint}px) by PHP.
 * 
 * Single source of truth for mobile styles.
 * Default breakpoint: 1420px (can be customized in plugin settings)
 */

/* Hide desktop elements */
.universal-nav__menu,
.main-nav__menu,
.main-nav__actions {
  display: none;
}

/* Adjust brand logo for mobile */
.main-nav__brand-logo {
  margin-inline-end: auto;
}

/*.main-nav__brand-logo svg,
.main-nav__brand-logo img {
  block-size: 32px;
}*/

/* Show mobile toggle */
.main-nav__mobile-toggle {
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: var(--space-2);
  inline-size: 44px;
  block-size: 44px;
}

.main-nav__mobile-toggle:focus-visible {
  outline: 2px solid var(--primary-color) !important;
  outline-offset: 4px !important;
  box-shadow: none !important;
}

/* Hamburger icon */
.main-nav__hamburger {
  position: relative;
  inline-size: 24px;
  block-size: 2px;
  background: var(--color-text-inverse);
  display: block;
}

.main-nav__hamburger::before,
.main-nav__hamburger::after {
  content: '';
  position: absolute;
  inline-size: 100%;
  block-size: 2px;
  background: var(--color-text-inverse);
  inset-inline-start: 0;
}

.main-nav__hamburger::before {
  inset-block-start: -8px;
}

.main-nav__hamburger::after {
  inset-block-start: 8px;
}

@media (prefers-reduced-motion: no-preference) {
  .main-nav__hamburger,
  .main-nav__hamburger::before,
  .main-nav__hamburger::after {
    transition: all var(--transition-speed-default) var(--transition-easing-default);
  }
}

/* Hamburger animation when menu is open */
.main-nav__mobile-toggle[aria-expanded="true"] .main-nav__hamburger {
  background: transparent;
}

.main-nav__mobile-toggle[aria-expanded="true"] .main-nav__hamburger::before {
  inset-block-start: 0;
  transform: rotate(45deg);
}

.main-nav__mobile-toggle[aria-expanded="true"] .main-nav__hamburger::after {
  inset-block-start: 0;
  transform: rotate(-45deg);
}

/* Mobile menu panel */
.main-nav__mobile-menu {
  position: fixed;
  inset-block-start: 0;
  inset-inline-end: 0;
  inline-size: min(400px, 85vw);
  block-size: 100vh;
  block-size: 100dvh;
  background: var(--color-background-primary);
  box-shadow: var(--shadow-xl);
  overflow-y: auto;
  z-index: calc(var(--z-index-modal) + 1);
  display: flex;
  flex-direction: column;
}

.main-nav__mobile-menu[hidden] {
  display: none;
}

@media (prefers-reduced-motion: no-preference) {
  .main-nav__mobile-menu {
    animation: slideInRight var(--transition-speed-default) var(--transition-easing-out);
  }
}

@keyframes slideInRight {
  from {
    transform: translateX(100%);
  }
  to {
    transform: translateX(0);
  }
}

.main-nav__mobile-header {
  display: flex;
  justify-content: flex-end;
  padding: var(--space-4);
  border-block-end: 1px solid var(--color-border-default);
}

.main-nav__mobile-close {
  background: transparent;
  border: none;
  color: var(--color-text-primary);
  cursor: pointer;
  font-size: var(--font-size-2xl);
  padding: var(--space-2);
  inline-size: 44px;
  block-size: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.main-nav__mobile-close:focus-visible {
  outline: 2px solid var(--primary-color) !important;
  outline-offset: -2px !important;
  box-shadow: none !important;
}

.main-nav__mobile-search {
  padding: var(--space-4);
  border-block-end: 1px solid var(--color-border-default);
}

.main-nav__mobile-search .main-nav__search {
  color: var(--color-text-primary);
  inline-size: 100%;
  justify-content: center;
  padding: var(--space-4);
  background: var(--color-background-secondary);
  border-radius: var(--border-radius-default);
}

.main-nav__mobile-items {
  list-style: none;
  margin: 0;
  padding: 0;
  flex: 1;
}

.main-nav__mobile-link {
  background: transparent;
  border: none;
  border-block-end: 1px solid var(--color-border-subtle);
  color: var(--color-text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-family: var(--font-heading);
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  padding: var(--space-5) var(--space-4);
  text-align: start;
  inline-size: 100%;
  text-decoration: none;
}

/* Mobile link when it's an anchor tag */
a.main-nav__mobile-link {
  color: var(--color-text-primary);
}

.main-nav__mobile-link:focus-visible {
  outline: 2px solid var(--primary-color) !important;
  outline-offset: -2px !important;
  box-shadow: none !important;
}

@media (prefers-reduced-motion: no-preference) {
  .main-nav__mobile-link .main-nav__icon {
    transition: transform var(--transition-speed-fast) var(--transition-easing-default);
  }
}

.main-nav__mobile-link[aria-expanded="true"] .main-nav__icon {
  transform: rotate(180deg);
}

.main-nav__mobile-dropdown {
  background: var(--color-background-secondary);
  display: flex;
  flex-direction: column;
  padding: var(--space-2);
}

.main-nav__mobile-dropdown[hidden] {
  display: none;
}

.main-nav__mobile-dropdown a {
  color: var(--color-text-secondary);
  font-family: var(--font-body);
  font-size: var(--font-size-base);
  padding: var(--space-3) var(--space-4);
  text-decoration: none;
  border-radius: var(--border-radius-default);
  position: relative;
  padding-inline-end: 2.5rem; /* Space for external icon */
}

@media (prefers-reduced-motion: no-preference) {
  .main-nav__mobile-dropdown a {
    transition: background-color var(--transition-speed-fast) var(--transition-easing-default);
  }
}

.main-nav__mobile-dropdown a:hover,
.main-nav__mobile-dropdown a:focus-visible {
  background: var(--color-background-primary);
}

.main-nav__mobile-dropdown a:focus-visible {
  outline: 2px solid var(--primary-color) !important;
  outline-offset: -2px !important;
  box-shadow: none !important;
}

/* Mobile dropdown external link icons - positioned top right */
.main-nav__mobile-dropdown a .nav-icon--external {
  inset-block-start: var(--space-3);
  inset-inline-end: var(--space-4);
}

.main-nav__mobile-dropdown a[data-external="true"] .nav-icon--external {
  opacity: 0.5;
}

.main-nav__mobile-dropdown a:hover .nav-icon--external,
.main-nav__mobile-dropdown a:focus-visible .nav-icon--external {
  opacity: 1;
}

/* Mobile dropdown title (when nav item is a link) */
.main-nav__mobile-dropdown-title {
  font-family: var(--font-heading);
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  border-block-end: 1px solid var(--color-border-secondary);
  margin-block-end: var(--space-2);
  padding-block-end: var(--space-2);
}

.main-nav__mobile-dropdown-title:hover,
.main-nav__mobile-dropdown-title:focus-visible {
  background: var(--color-background-tertiary);
}

/* ============================================
   NESTED ACCORDIONS (3rd Level Support)
   ============================================ */

/* 2nd level links that have children (nested accordion triggers) */
.main-nav__mobile-link--nested {
  background: transparent;
  border: none;
  color: var(--color-text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-family: var(--font-body);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-semibold);
  padding: var(--space-3) var(--space-4);
  padding-inline-start: var(--space-6); /* Indent 2nd level */
  text-align: start;
  inline-size: 100%;
  border-radius: var(--border-radius-default);
}

@media (prefers-reduced-motion: no-preference) {
  .main-nav__mobile-link--nested {
    transition: background-color var(--transition-speed-fast) var(--transition-easing-default);
  }
  
  .main-nav__mobile-link--nested .main-nav__icon {
    transition: transform var(--transition-speed-fast) var(--transition-easing-default);
  }
}

.main-nav__mobile-link--nested:hover,
.main-nav__mobile-link--nested:focus-visible {
  background: var(--color-background-primary);
}

.main-nav__mobile-link--nested:focus-visible {
  outline: 2px solid var(--primary-color) !important;
  outline-offset: -2px !important;
  box-shadow: none !important;
}

.main-nav__mobile-link--nested[aria-expanded="true"] .main-nav__icon {
  transform: rotate(180deg);
}

/* Nested dropdown container (3rd level items) */
.main-nav__mobile-dropdown--nested {
  background: var(--color-background-tertiary);
  display: flex;
  flex-direction: column;
  padding: var(--space-2);
  padding-inline-start: var(--space-8); /* Extra indent for 3rd level */
}

.main-nav__mobile-dropdown--nested[hidden] {
  display: none;
}

/* 3rd level items */
.main-nav__mobile-subitem {
  color: var(--color-text-secondary);
  font-family: var(--font-body);
  font-size: var(--font-size-sm);
  padding: var(--space-3) var(--space-4);
  text-decoration: none;
  border-radius: var(--border-radius-default);
  position: relative;
  padding-inline-end: 2.5rem; /* Space for external icon */
  display: block;
}

@media (prefers-reduced-motion: no-preference) {
  .main-nav__mobile-subitem {
    transition: background-color var(--transition-speed-fast) var(--transition-easing-default);
  }
}

.main-nav__mobile-subitem:hover,
.main-nav__mobile-subitem:focus-visible {
  background: var(--color-background-secondary);
}

.main-nav__mobile-subitem:focus-visible {
  outline: 2px solid var(--primary-color) !important;
  outline-offset: -2px !important;
  box-shadow: none !important;
}

/* Parent item link within nested dropdown (optional link to 2nd level item itself) */
.main-nav__mobile-subitem--parent {
  font-weight: var(--font-weight-semibold);
  border-block-end: 1px solid var(--color-border-subtle);
  margin-block-end: var(--space-2);
  padding-block-end: var(--space-3);
}

/* External link icons for 3rd level items */
.main-nav__mobile-subitem .nav-icon--external {
  inset-block-start: var(--space-3);
  inset-inline-end: var(--space-4);
}

.main-nav__mobile-subitem[data-external="true"] .nav-icon--external {
  opacity: 0.5;
}

.main-nav__mobile-subitem:hover .nav-icon--external,
.main-nav__mobile-subitem:focus-visible .nav-icon--external {
  opacity: 1;
}

.main-nav__mobile-cta {
  padding: var(--space-4);
  border-block-start: 1px solid var(--color-border-default);
}

.main-nav__mobile-cta .main-nav__cta {
  inline-size: 100%;
  display: block;
  text-align: center;
}

.main-nav__mobile-universal {
  /* Mobile universal nav always has dark background and white text - Patterson branding */
  background: oklch(0.15 0 0 / 0.63);
  color: var(--color-white);
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
  padding: var(--space-4);
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
  inline-size: 100%;
}

/* Fallback for browsers without backdrop-filter */
@supports not (backdrop-filter: blur(10px)) {
  .main-nav__mobile-universal {
    background: oklch(0.15 0 0 / 0.9);
  }
}

.main-nav__mobile-universal-logo {
  display: flex;
  align-items: center;
  justify-content: center;
  padding-block: var(--space-2);
}

.main-nav__mobile-universal-logo a {
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 0;
}

.main-nav__mobile-universal-logo img {
  display: block;
  block-size: auto;
  max-inline-size: 100%;
  margin-inline: auto;
}

.main-nav__mobile-universal-menu {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.main-nav__mobile-universal-menu a {
  /* Mobile universal nav links always white - Patterson branding */
  color: var(--color-white);
  font-family: var(--font-heading);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-semibold);
  padding: var(--space-2);
  text-decoration: none;
  display: block;
  text-align: center;
}

@media (prefers-reduced-motion: no-preference) {
  .main-nav__mobile-universal-menu a {
    transition: opacity var(--transition-speed-fast) var(--transition-easing-default);
  }
}

.main-nav__mobile-universal-menu a:hover,
.main-nav__mobile-universal-menu a:focus-visible {
  opacity: 0.8;
}

.main-nav__mobile-universal-menu a:focus-visible {
  outline: 2px solid currentColor !important;
  outline-offset: 4px !important;
  box-shadow: none !important;
}

/* Backdrop */
.main-nav__backdrop {
  position: fixed;
  inset: 0;
  background: oklch(0.15 0 0 / 0.5);
  z-index: var(--z-index-modal);
}

.main-nav__backdrop[hidden] {
  display: none;
}

@media (prefers-reduced-motion: no-preference) {
  .main-nav__backdrop {
    animation: fadeIn var(--transition-speed-default) var(--transition-easing-default);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Hide desktop dropdowns on mobile */
.main-nav__dropdown {
  display: none;
}

/* Adjust container padding */
.main-nav__container {
  padding-inline: var(--space-4);
}

/* Universal nav adjustments */
.universal-nav {
  block-size: auto;
  min-block-size: 46px;
}

.main-nav__logo img {
  max-inline-size: 100px;
}

.universal-nav__menu {
  display: none;
}

/* Main nav adjustments */
.main-nav {
  block-size: auto;
  min-block-size: 64px;
}

